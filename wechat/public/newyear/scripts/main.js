"use strict";function initPage(){$("#download").on("click",function(){isClient?SYDBridge.openNative("account"):isiOS?isWechat?location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.souyidai.investment.android&ckey=CK1289998290990":location.href="https://itunes.apple.com/cn/app/sou-yi-dai-li-cai/id946672680?mt=8":isWechat?location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.souyidai.investment.android&ckey=CK1289998290990":location.href="https://static.souyidai.com/downloads/SouyidaiClient.2.6.14.update.apk"}),document.body.addEventListener("touchstart",function(e){e=e.changedTouches[0],onStart(e)}),document.body.addEventListener("touchmove",function(e){onMove(e.changedTouches[0],e)}),document.body.addEventListener("touchend",function(e){onEnd(e.changedTouches[0])}),window.onorientationchange=orientationChange,pageWidth=$(window).width(),pageHeight=$(".container").height(),pages=$(".container section"),$(".container section").css({width:pageWidth+"px",height:pageHeight+"px"}),secHeight=pageHeight*$(".container section").length,lineHeight=832*secHeight/pageHeight,$(".sec, .line").addClass("drag"),animatePage(curPage),$(".page-loading").removeClass("page-loading")}function orientationChange(){setTimeout(function(){initPage()},500)}function onStart(e){return 1==movePrevent?(event.preventDefault(),!1):(touchDown=!0,startX=e.pageX,startY=e.pageY,$(".sec, .line").addClass("drag"),margin=$(".sec").css("-webkit-transform"),margin=margin.replace("matrix(",""),margin=margin.replace(")",""),margin=margin.split(","),void(margin=parseInt(margin[5])))}function onMove(e,t){if(1==movePrevent||1!=touchDown)return event.preventDefault(),!1;if(event.preventDefault(),0==scrollPrevent&&e.pageY!=startY){var a=margin+e.pageY-startY;$(".sec").css("-webkit-transform","matrix(1, 0, 0, 1, 0, "+a+")");var n=lineHeight/secHeight*a;$(".line").css("-webkit-transform","matrix(1, 0, 0, 1, 0, "+n+")")}}function onEnd(e){if(1==movePrevent)return event.preventDefault(),!1;if(touchDown=!1,0==scrollPrevent){var t=(e.pageX,e.pageY);Math.abs(t-startY)<=60?animatePage(curPage):t>startY?prevPage():nextPage()}$(".sec, .line").removeClass("drag")}function prevPage(){var e=curPage-1;animatePage(e)}function nextPage(){var e=curPage+1;animatePage(e)}function animatePage(e){0>e&&(e=0),e>$(".container section").length-1&&(e=$(".container section").length-1),curPage=e;var t=e*-pageHeight;$(".sec").css({"-webkit-transform":"matrix(1, 0, 0, 1, 0, "+t+")"});var a=-parseInt(curPage*pageHeight*(lineHeight/secHeight));$(".line").css({"-webkit-transform":"matrix(1, 0, 0, 1, 0, "+a+")"}),movePrevent=!0,setTimeout("movePrevent=false;",500),$(pages[curPage]).hasClass("sec0"+(curPage+1)+"-show")||($(pages[curPage]).addClass("sec0"+(curPage+1)+"-show"),$(pages[curPage]).addClass("sec-show"),$(pages[curPage]).hasClass("sec-radar")&&setTimeout(function(){radarChart()},1e3)),$(pages[curPage-1]).removeClass("sec0"+curPage+"-show"),$(pages[curPage-1]).removeClass("sec-show"),$(pages[curPage+1]).removeClass("sec0"+(curPage+2)+"-show"),$(pages[curPage+1]).removeClass("sec-show")}function radarChart(e){var t={scaleShowLine:!1,angleShowLineOut:!1,scaleShowLabels:!1,pointDot:!1,showTooltips:!1,datasetFill:!0,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:function(){}},a={labels:["","","","",""],datasets:[{fillColor:"rgba(253,146,2,0.8)",strokeColor:"rgba(220,220,220,0)",data:radarChartData}]},n=document.getElementById("radarChart").getContext("2d");new Chart(n).Radar(a,t)}function initShare(){isWechat?($.ajax({url:"/serve/jssign",type:"GET",dataType:"json",data:{url:location.href},success:function(e){0===e.errorCode&&wx.config(e.result)}}),wx.ready(function(){wx.onMenuShareTimeline({title:WX_DEFAULT_SHARE.timelineDesc,link:WX_DEFAULT_SHARE.link,imgUrl:WX_DEFAULT_SHARE.imgUrl,success:function(){_paq.push(["trackEvent","timemachine","share","timeline"]),$(".share-overlay").hide()}}),wx.onMenuShareAppMessage({title:WX_DEFAULT_SHARE.title,desc:WX_DEFAULT_SHARE.desc,link:WX_DEFAULT_SHARE.link,imgUrl:WX_DEFAULT_SHARE.imgUrl,success:function(){_paq.push(["trackEvent","timemachine","share","message"]),$(".share-overlay").hide()}})}),$(".radar-btn,.coupon").on("click",function(){$(".share-overlay").show()}),$(".share-overlay").on("click",function(){$(".share-overlay").hide()})):isClient&&$(".radar-btn,.coupon").on("click",function(){var e={title:WX_DEFAULT_SHARE.title,description:WX_DEFAULT_SHARE.desc,url:WX_DEFAULT_SHARE.link,imageUrl:WX_DEFAULT_SHARE.imgUrl,shareMenuList:["wechat_friend","wechat_friend_circle","copy_link"]};_paq.push(["trackEvent","timemachine","share","client"]),SYDBridge.openNative("share",e)})}function initCoupon(e,t,a){var n={"timeA-1":2,"timeA-2":5,"timeA-3":10,"timeA-4":10,"timeA-5":10,"timeA-6":20,"timeB-1":3,"timeB-2":5,"timeB-3":10,"timeB-4":20,"timeB-5":20,"timeB-6":30,"timeC-1":5,"timeC-2":5,"timeC-3":10,"timeC-4":20,"timeC-5":50,"timeC-6":50};$.ajax({url:"/timemachine/share",type:"POST",dataType:"json",data:{uid:e,hashid:t,receipt_sum:a},success:function(e){if(e.hasOwnProperty("data")){var t=e.data.coupon;0===t.length?$("#coupon-tip").text("快点击红包去找好友帮你拆吧").show():1===t.length?($("#coupon-tip").text("恭喜获得"+n[t[0]]+"元红包!").show(),$("#coupon-num").show().find(".num").text("2"),$(".coupon").eq(0).addClass("open").find(".coupon-num").text(n[t[0]]+"元")):2===t.length?($("#coupon-tip").text("恭喜获得"+(n[t[1]]+n[t[0]])+"元红包!").show(),$("#coupon-num").show().find(".num").text("1"),$(".coupon").eq(0).addClass("open").find(".coupon-num").text(n[t[0]]+"元"),$(".coupon").eq(1).addClass("open").find(".coupon-num").text(n[t[1]]+"元"),$(".coupon-text-2").hide()):t.length>=3&&($("#coupon-tip").text("你已经拆开了全部时光红包").show(),$(".coupon").eq(0).addClass("open").find(".coupon-num").text(n[t[0]]+"元"),$(".coupon").eq(1).addClass("open").find(".coupon-num").text(n[t[1]]+"元"),$(".coupon").eq(2).addClass("open").find(".coupon-num").text(n[t[2]]+"元"),$(".coupon-text-1").hide(),$(".coupon-text-2").hide())}}})}var startX=0,startY=0,margin=0,pages=null,curPage=0,pageWidth=0,pageHeight=0,lineHeight=0,secHeight=0,targetElement=null,scrollPrevent=!1,movePrevent=!1,touchDown=!1,num=null,curNum=0,radarChartData=[],WX_DEFAULT_SHARE={title:"纳尼？！2015我居然在搜易贷赚了这么多？",desc:"快来帮我拆红包!我心目中最棒的理财平台哟!来看看你错过多少收益！",timelineDesc:"纳尼？！2015我居然在搜易贷赚了这么多？快来帮我拆红包，看看你错过多少收益！",imgUrl:"https://weixin.souyidai.com/newyear/images/share.png",link:"https://weixin.souyidai.com/newyear/weixin.html?hashid="};Handlebars.registerHelper("date",function(e){var t=new Date(e);t.getHours(),t.getMinutes();return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日"}),Handlebars.registerHelper("money",function(e){return(e/100).toString().replace(/(\d)(?=(?:\d{3})+(?:\.\d+)?$)/g,"$1,")}),Handlebars.registerHelper("each",function(e,t){for(var a="",n=0,i=e.length;i>n;n++)a+=t.fn(e[n]);return a}),$(function(){$(".coupon-icon").on("click",function(){animatePage(6)}),$.ajax({url:"/timemachine",type:"POST",dataType:"json",data:{time:(new Date).getTime()},success:function(e){if(errorHandle(e)){var t=Handlebars.compile($("#new-user").html()),a=Handlebars.compile($("#invest-user").html()),n="";if(1===e.data||2===e.data)n=t(),$("body").removeClass("yellow").addClass("red"),$(".sec-load .main-title").hide(),$(".sec-load .sub-title").hide(),WX_DEFAULT_SHARE.link="https://weixin.souyidai.com/newyear/";else{var i=e.data;0===i.ubid_amount?(n=t(),$("#create_time").text(Handlebars.helpers.date(i.create_time)),$("#create_day").text(i.create_day),$("body").removeClass("yellow").addClass("red"),WX_DEFAULT_SHARE.link="https://weixin.souyidai.com/newyear/"):(n=a(i),$("#create_time").text(Handlebars.helpers.date(i.create_time)),$("#create_day").text(i.create_day),radarChartData=[i.ubid_amount_rank,i.invite_num_rank,i.rate_by_weighting_rank,i.invest_type_rank,i.coupon_used_rank],WX_DEFAULT_SHARE.link+=i.hashid,initCoupon(i.uid,i.hashid,i.receipt_sum),$(".coupon-icon").show())}$(".sec").append(n),initPage(),initShare()}},error:function(){toastShow("系统繁忙,请稍候再试")}})});